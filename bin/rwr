#!/usr/bin/env ruby

# Much of this script borrowed from:
# https://github.com/whitequark/parser/blob/master/lib/parser/runner.rb and friends

$LOAD_PATH.unshift(File.expand_path('../../lib', __FILE__))
require 'real_world_rails/parser_factory'
require 'real_world_rails/model_processor'

def list_models
  parser = ParserFactory.create
  model_files = Dir.glob("**/models/**/*.rb")
  model_processor = ModelProcessor.new
  model_files.each do |filename|
    # filename = "apps/trailmix/app/models/subscription.rb"
    source = File.read(filename)
    buffer = Parser::Source::Buffer.new filename
    buffer.source = source
    parser.reset
    ast = parser.parse(buffer)
    model_processor.process(ast)
  end
end

list_models
